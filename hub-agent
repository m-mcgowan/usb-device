#!/bin/bash
# SPDX-License-Identifier: MIT
# Copyright (c) 2026 Mat McGowan
# hub-agent â€” USB Insight Hub display agent
#
# Wrapper that runs hub_agent.py using the PlatformIO venv (for pyserial).
#
# Usage:
#   hub-agent                     # watch mode (continuous updates)
#   hub-agent --once              # sync once and exit
#   hub-agent --status            # print hub status and exit
#
# Prefer using via usb-device:
#   usb-device hub watch
#   usb-device hub sync
#   usb-device hub status

_self="$0"
[ -L "$_self" ] && _self="$(readlink "$_self")"
SCRIPT_DIR="$(cd "$(dirname "$_self")" && pwd)"
unset _self

# Use PlatformIO venv python (has pyserial), fall back to system python3
PIO_PYTHON="${HOME}/.platformio/penv/bin/python3"
if [ ! -x "$PIO_PYTHON" ]; then
    PIO_PYTHON="python3"
fi

exec "$PIO_PYTHON" -u "${SCRIPT_DIR}/hub_agent.py" "$@"
